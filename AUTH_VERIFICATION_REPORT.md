# โ ูุฑุงุฌุนุฉ ุดุงููุฉ ููุธุงู ุชุณุฌูู ุงูุฏุฎูู ููุงุนุฏุฉ ุงูุจูุงูุงุช

## ๐ฏ ุญุงูุฉ ุงููุดุฑูุน

ุชู ุฅุฌุฑุงุก **ูุญุต ุดุงูู ูุฅุตูุงุญ ุฌููุน ุงููุดุงูู** ูู ูุธุงู ุชุณุฌูู ุงูุฏุฎูู ููุงุนุฏุฉ ุงูุจูุงูุงุช.

---

## ๐ ุงููุญูุตุงุช ุงููููุฐุฉ

### 1๏ธโฃ ูุธุงู ุงููุตุงุฏูุฉ (UserContext.tsx) โ

**ุงูุญุงูุฉ:** โ ุฌุงูุฒ ูุขูู

**ูุง ุชู ุชุญูู ููู:**

- โ ุชุณุฌูู ุฏุฎูู ุนุจุฑ Supabase Auth
- โ ุชุณุฌูู ุญุณุงุจ ุฌุฏูุฏ ูุน ุฅูุดุงุก record ูู ุฌุฏูู users
- โ ุชุญููู ุจูุงูุงุช ุงููุณุชุฎุฏู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
- โ ุงุณุชูุงุน ูุชุบููุฑุงุช ุงููุตุงุฏูุฉ (onAuthStateChange)
- โ ูุนุงูุฌุฉ ูุงููุฉ ููุฃุฎุทุงุก ุจุฑุณุงุฆู ุจุงูุนุฑุจูุฉ
- โ ุฏุนู ุงูู fallback ุนูุฏูุง ูุง ูููู ุงููุณุชุฎุฏู ููุฌูุฏ ูู ุฌุฏูู users
- โ Server-side rendering support

**ุงููููุฒุงุช:**

```typescript
// ุชุญููู ุงูุฌูุณุฉ ุชููุงุฆูุงู ุนูุฏ ุจุฏุก ุงูุชุทุจูู
useEffect(() => {
  supabase.auth.getSession().then(({ data: { session } }) => {
    if (session?.user) {
      loadUserData(session.user);
    }
  });

  // ุงูุงุณุชูุงุน ููุชุบููุฑุงุช ูู ุงูููุช ุงููุนูู
  const {
    data: { subscription },
  } = supabase.auth.onAuthStateChange(async (_event, session) => {
    if (session?.user) {
      await loadUserData(session.user);
    } else {
      setUser(null);
    }
  });
});
```

---

### 2๏ธโฃ ุตูุญุฉ ุชุณุฌูู ุงูุฏุฎูู (login/page.tsx) โ

**ุงูุญุงูุฉ:** โ ูุญุณููุฉ ูุน ุฅุนุงุฏุฉ ุงูุชูุฌูู ุงูุฐููุฉ

**ูุง ุชู ุชุญูู ููู:**

- โ ูุฑุงุกุฉ ูุนุงูู `redirect` ูู URL
- โ ุฅุนุงุฏุฉ ุชูุฌูู ุงููุณุชุฎุฏู ููููุงู ุงูููุตูุฏ ุจุนุฏ ุงูุชุณุฌูู
- โ ุฑุณุงุฆู ุฎุทุฃ ูุงุถุญุฉ ุจุงูุนุฑุจูุฉ
- โ ูุนุงูุฌุฉ ุฌููุน ุงูุญุงูุงุช (ุจุฑูุฏ ุฎุงุทุฆุ ูููุฉ ุฎุงุทุฆุฉุ ุฅูุฎ)
- โ ุงุณุชุฎุฏุงู `useSearchParams()` ุงูุตุญูุญ

**ูุซุงู:**

```typescript
const searchParams = useSearchParams();
const redirectTo = searchParams.get("redirect") || "/dashboard";

// ุจุนุฏ ุชุณุฌูู ุงูุฏุฎูู:
router.push(redirectTo);
```

---

### 3๏ธโฃ ุตูุญุฉ ุงูุชุณุฌูู ุงูุฌุฏูุฏ (register/page.tsx) โ

**ุงูุญุงูุฉ:** โ ุชุนูู ุจุดูู ุตุญูุญ

**ูุง ุชู ุชุญูู ููู:**

- โ ุงูุชุญูู ูู ุชุทุงุจู ูููุงุช ุงููุฑูุฑ
- โ ุงูุชุญูู ูู ุทูู ูููุฉ ุงููุฑูุฑ (6 ุฃุญุฑู ุนูู ุงูุฃูู)
- โ ุฅูุดุงุก ุญุณุงุจ ูู Supabase Auth
- โ ุฅูุดุงุก record ูู ุฌุฏูู users
- โ ูุนุงูุฌุฉ ุงูุจุฑูุฏ ุงูููุฑุฑ ุจุดูู ุตุญูุญ
- โ ุนุฑุถ ุฑุณุงูุฉ ุชุฃููุฏ ุงูุจุฑูุฏ ุนูุฏ ุงูุญุงุฌุฉ

---

### 4๏ธโฃ ุตูุญุฉ ูุณูุงู ูููุฉ ุงููุฑูุฑ (forgot-password/page.tsx) โ

**ุงูุญุงูุฉ:** โ ูุชูุงููุฉ ูุน Supabase

**ูุง ุชู ุชุญูู ููู:**

- โ ุงุณุชุฎุฏุงู `resetPasswordForEmail()` ูู Supabase
- โ ุชุญููู ุชููุงุฆู ูุตูุญุฉ reset-password
- โ ุฑุณุงุฆู ุฎุทุฃ ูุงุถุญุฉ
- โ ุญุงูุงุช ุงูุชุญููู ูุน Loader
- โ ุฏุนู ุงููุถุน ุงููุธูู

```typescript
const { error } = await supabase.auth.resetPasswordForEmail(email, {
  redirectTo: `${window.location.origin}/reset-password`,
});
```

---

### 5๏ธโฃ ุตูุญุฉ ุฅุนุงุฏุฉ ุชุนููู ูููุฉ ุงููุฑูุฑ (reset-password/page.tsx) โ

**ุงูุญุงูุฉ:** โ ุฌุฏูุฏุฉ ูุขููุฉ

**ูุง ุชู ุชุญูู ููู:**

- โ ุงูุชุญูู ูู ุตุญุฉ ุงูุฑุงุจุท ุนูุฏ ุงูุชุญููู
- โ ุงูุชุญูู ูู ูุฌูุฏ ุฌูุณุฉ ูุดุทุฉ ูู Supabase
- โ ุชุญุฏูุซ ูููุฉ ุงููุฑูุฑ ุจุดูู ุขูู
- โ ุนุฑุถ ูุชุทูุจุงุช ูููุฉ ุงููุฑูุฑ
- โ ุฑุณุงูุฉ ูุฌุงุญ ูุฅุนุงุฏุฉ ุชูุฌูู ุชููุงุฆูุฉ
- โ ูุนุงูุฌุฉ ุงูุฑูุงุจุท ุงูููุชููุฉ ุงูุตูุงุญูุฉ

**ุงูููุฒุงุช:**

```typescript
// ุงูุชุญูู ูู ุงูุฌูุณุฉ
const {
  data: { session },
  error: sessionError,
} = await supabase.auth.getSession();

if (!session?.user) {
  // ุฑุงุจุท ุบูุฑ ุตุญูุญ
  setError("ุฑุงุจุท ุฅุนุงุฏุฉ ุงูุชุนููู ุบูุฑ ุตุญูุญ ุฃู ููุชูู ุงูุตูุงุญูุฉ");
}

// ุชุญุฏูุซ ูููุฉ ุงููุฑูุฑ
const { error } = await supabase.auth.updateUser({
  password: password,
});
```

---

### 6๏ธโฃ Middleware (middleware.ts) โ

**ุงูุญุงูุฉ:** โ ูุญุณูู ูุจุณูุท

**ูุง ุชู ุชุญูู ููู:**

- โ ุญุฐู ุงูุชุนููุฏ ุบูุฑ ุงูุถุฑูุฑู (auth-helpers-nextjs)
- โ Force dynamic rendering ูู dashboard
- โ Cache control headers ุตุญูุญ ููู ISR

**ุงูุชุจุณูุท:**

```typescript
// ูุฏูู: ูุนูุฏ ููุนุชูุฏ ุนูู auth-helpers-nextjs
// ุฌุฏูุฏ: ุจุณูุท ููุนุงู

// ุงูุญูุงูุฉ ุชุชู ุงูุขู ูู dashboard layout ุจุดูู ุฃูุถู
```

---

### 7๏ธโฃ Dashboard Layout (dashboard/layout.tsx) โ

**ุงูุญุงูุฉ:** โ ูุญูู ุงูุขู

**ูุง ุชู ุฅุถุงูุชู:**

- โ ุงูุชุญูู ูู ุงูุฌูุณุฉ ุนูุฏ ุฏุฎูู dashboard
- โ ุฅุนุงุฏุฉ ุชูุฌูู ูู login ุจูุนุงูู redirect
- โ ุนุฑุถ loading state ุจูููุง ูุชู ุงูุชุญูู
- โ ุนุฏู ุนุฑุถ ูุญุชูู Dashboard ูููุณุชุฎุฏููู ุบูุฑ ุงููุตุงุฏููู

```typescript
useEffect(() => {
  if (!loading && !user) {
    router.push('/login?redirect=/dashboard');
  }
}, [user, loading, router]);

if (loading) {
  return <LoadingState />;
}

if (!user) {
  return null;
}

return <DashboardContent />;
```

---

### 8๏ธโฃ ูุงุนุฏุฉ ุงูุจูุงูุงุช Schema (schema.sql) โ

**ุงูุญุงูุฉ:** โ ูุงูู ูุขูู

**ูุง ุชู ุชุญูู ููู:**

#### ุงูุฌุฏุงูู:

1. โ `users` - ูุนูููุงุช ุงููุณุชุฎุฏููู
2. โ `research_projects` - ูุดุงุฑูุน ุงูุจุญุซ
3. โ `sources` - ุงููุตุงุฏุฑ ูุงููุฑุงุฌุน
4. โ `schedule_tasks` - ุงูููุงู ูุงูุฌุฏูู ุงูุฒููู
5. โ `ai_conversations` - ูุญุงุฏุซุงุช ุงูุฐูุงุก ุงูุงุตุทูุงุนู
6. โ `notifications` - ุงูุฅุดุนุงุฑุงุช
7. โ `user_messages` - ุงูุฑุณุงุฆู ุจูู ุงููุณุชุฎุฏููู

#### ุงูุญูุงูุฉ (RLS):

- โ ุฌููุน ุงูุฌุฏุงูู ูุญููุฉ ุจู Row Level Security
- โ ูู ูุณุชุฎุฏู ูุฑู ุจูุงูุงุชู ููุท
- โ ุณูุงุณุงุช INSERT, SELECT, UPDATE, DELETE ูุนุฑูุฉ ุจุดูู ุตุญูุญ

#### ุงูููุงุฑุณ (Indexes):

- โ `idx_research_projects_user_id`
- โ `idx_sources_user_id` ู `idx_sources_research_id`
- โ `idx_schedule_tasks_user_id` ู `idx_schedule_tasks_research_id`
- โ `idx_ai_conversations_user_id`
- โ `idx_notifications_user_id`
- โ `idx_user_messages_sender_id`, `recipient_id`, `created_at`

#### ุงูู Triggers:

- โ `handle_updated_at()` - ุชุญุฏูุซ `updated_at` ุชููุงุฆูุงู
- โ `handle_new_user()` - ุฅูุดุงุก record ูู ุฌุฏูู users ุชููุงุฆูุงู

**ุงูุชุญูู ูู ุงููููุฏ:**

```sql
-- ุฌููุน ุงูุญููู ุงููุทููุจุฉ ููุฌูุฏุฉ
-- ุฌููุน ุงูุนูุงูุงุช ุงูุฃุฌูุจูุฉ ุตุญูุญุฉ
-- ุฌููุน ุงูู CHECK constraints ูุนุฑูุฉ ุจุดูู ุตุญูุญ
```

---

### 9๏ธโฃ supabaseData.ts โ

**ุงูุญุงูุฉ:** โ ูุงูู ูุน ุฌููุน ุงูุฏูุงู

**ูุง ุชู ุชุญูู ููู:**

- โ ุฏูุงู ุงูุจุญุซ: `getUserResearch()`, `saveResearch()`
- โ ุฏูุงู ุงููุตุงุฏุฑ: `getUserSources()`, `addSource()`, `updateSource()`, `deleteSource()`
- โ ุฏูุงู ุงูููุงู: `getUserTasks()`, `addTask()`, `updateTask()`, `deleteTask()`
- โ ุฏูุงู ุงูุฑุณุงุฆู: `sendMessage()`, `getConversation()`, `getUserConversationsList()`, `markMessageAsRead()`, `markConversationAsRead()`, `deleteMessage()`
- โ ุฏูุงู ุงููุญุงุฏุซุงุช: `getUserConversations()`, `saveConversation()`, `deleteConversation()`
- โ ุฏูุงู ุงูุฅุดุนุงุฑุงุช: `getUserNotifications()`, `markNotificationAsRead()`

---

## ๐ก๏ธ ุงูุฃูุงู

### Row Level Security (RLS)

```sql
-- ูู ูุณุชุฎุฏู ูุฑู ุจูุงูุงุชู ููุท
CREATE POLICY "Users can view their own data" ON public.users
    FOR SELECT USING (auth.uid() = id);

-- ูุง ูููู ุฑุคูุฉ ุจูุงูุงุช ุงููุณุชุฎุฏููู ุงูุขุฎุฑูู
-- ุญุชู ูู ุญุงูู ุงููุณุชุฎุฏู ุงููุตูู ูุจุงุดุฑุฉ
```

### Password Security

- โ ูููุงุช ุงููุฑูุฑ ูุดูุฑุฉ ูู Supabase
- โ ุนุฏู ุชุฎุฒูู ุงููููุงุช ูู localStorage
- โ ููู ุขูู ููุท ุนุจุฑ HTTPS

### Session Management

- โ ุฌูุณุงุช ุขููุฉ ุนุจุฑ Supabase Auth
- โ ุชูุชูู ุงูุฌูุณุฉ ุชููุงุฆูุงู
- โ ูุนุงููุฉ ุฎุงุตุฉ ููุฌูุณุงุช ุงูููุชููุฉ ุงูุตูุงุญูุฉ

### Email Verification

- โ ูุงุนุฏุฉ ุจูุงูุงุช ุชุชุทูุจ ุชุฃููุฏ ุงูุจุฑูุฏ ููุชุณุฌูู
- โ ุฑุงุจุท ุชุฃููุฏ ุจุฑูุฏ ุขูู

---

## ๐ ูุฎุทุท ุณูุฑ ุงูุนูููุฉ

### ุชุณุฌูู ุฏุฎูู ุนุงุฏู:

```
ุงููุณุชุฎุฏู
   โ
[Login Page] โ ูุฏุฎู ุงูุจุฑูุฏ ูุงููููุฉ
   โ
UserContext.login()
   โ
supabase.auth.signInWithPassword()
   โ
โ ุชุณุฌูู ุฏุฎูู ูุงุฌุญ
   โ loadUserData()
   โ
supabase.from("users").select()
   โ
UserContext.setUser()
   โ
router.push(redirectTo)  โ /dashboard
```

### ูุณูุงู ูููุฉ ุงููุฑูุฑ:

```
[Forgot Password Page]
   โ
ุฃุฏุฎู ุงูุจุฑูุฏ
   โ
supabase.auth.resetPasswordForEmail()
   โ
โ๏ธ ุฑุณุงูุฉ ุจุฑูุฏ ูุน ุฑุงุจุท
   โ
ุงููุณุชุฎุฏู ูููุฑ ุงูุฑุงุจุท
   โ
[Reset Password Page]
   โ
ุชุญูู ูู ุงูุฌูุณุฉ
   โ
ุฃุฏุฎู ูููุฉ ุงููุฑูุฑ ุงูุฌุฏูุฏุฉ
   โ
supabase.auth.updateUser()
   โ
โ ูุฌุญ
   โ
ุฅุนุงุฏุฉ ุชูุฌูู ูู [Login Page]
```

---

## โ ูุงุฆูุฉ ุงูุชุญูู ุงูููุงุฆูุฉ

### ุงููุตุงุฏูุฉ:

- [x] ุชุณุฌูู ุฏุฎูู ูุนูู
- [x] ุชุณุฌูู ุญุณุงุจ ุฌุฏูุฏ ูุนูู
- [x] ูุณูุงู ูููุฉ ุงููุฑูุฑ ูุนูู
- [x] ุฅุนุงุฏุฉ ุชุนููู ูููุฉ ุงููุฑูุฑ ูุนูู
- [x] ุชุณุฌูู ุงูุฎุฑูุฌ ูุนูู
- [x] ุงูุฌูุณุฉ ุชุจูู ุญูุฉ ุนูุฏ ุฅุนุงุฏุฉ ุชุญููู ุงูุตูุญุฉ

### ุงูุญูุงูุฉ:

- [x] Dashboard ูุญูู (ูุง ูููู ุฏุฎูู ุจุฏูู ุชุณุฌูู)
- [x] Row Level Security ูุฌูุฒ
- [x] ุงูุฑุณุงุฆู ุงูุฎุทุฃ ูุงุถุญุฉ ุจุงูุนุฑุจูุฉ
- [x] ูุนุงููุฉ ุงูุฌูุณุงุช ุงูููุชููุฉ

### ูุงุนุฏุฉ ุงูุจูุงูุงุช:

- [x] ุฌููุน ุงูุฌุฏุงูู ููุฌูุฏุฉ
- [x] ุฌููุน ุงูุญููู ุตุญูุญุฉ
- [x] ุฌููุน ุงูู Triggers ุชุนูู
- [x] ุฌููุน ุงูููุงุฑุณ ููุฌูุฏุฉ
- [x] ุฌููุน ุงูุณูุงุณุงุช ูุนุฑูุฉ

### ูุงุฌูุฉ ุงููุณุชุฎุฏู:

- [x] ุตูุญุงุช ุงูุชุณุฌูู ุฌูููุฉ ูุชูุงุนููุฉ
- [x] ุฏุนู ุงููุถุน ุงููุธูู
- [x] ุฑุณุงุฆู ุงูุฎุทุฃ ูุงุถุญุฉ
- [x] ุญุงูุงุช ุงูุชุญููู ูุนุฑูุถุฉ

---

## ๐ ุงูุฎุทูุงุช ุงูุชุงููุฉ

### ูุชุดุบูู ุงููุดุฑูุน:

```bash
# 1. ูู Supabase Dashboard - ููุฐ schema.sql
# SQL Editor โ New Query
# ุงูุณุฎ ูุญุชูู supabase/schema.sql
# ุงุถุบุท Run

# 2. ูู ูุดุฑูุนู ุงููุญูู
npm install

# 3. ูู ุจุฅูุดุงุก ุญุณุงุจุงุช ุชุฌุฑูุจูุฉ:
# - student@university.edu / 123456
# - prof@university.edu / 123456

# 4. ุดุบูู ุงููุดุฑูุน
npm run dev

# 5. ุงุฐูุจ ุฅูู http://localhost:3000
```

### ููุงุฎุชุจุงุฑ:

```
โ ุชุณุฌูู ุฏุฎูู: /login
โ ุชุณุฌูู ุญุณุงุจ: /register
โ ูุณูุงู ูููุฉ ุงููุฑูุฑ: /forgot-password
โ ุฅุนุงุฏุฉ ุชุนููู: /reset-password
โ Dashboard: /dashboard (ูุญูู)
```

---

## ๐ ุงููููุงุช ุงูุฑุฆูุณูุฉ

| ุงูููู                              | ุงูุญุงูุฉ | ุงููุฏู                  |
| ---------------------------------- | ------ | ---------------------- |
| `src/contexts/UserContext.tsx`     | โ     | ุฅุฏุงุฑุฉ ุงููุตุงุฏูุฉ ูุงูุฌูุณุฉ |
| `src/app/login/page.tsx`           | โ     | ุตูุญุฉ ุชุณุฌูู ุงูุฏุฎูู      |
| `src/app/register/page.tsx`        | โ     | ุตูุญุฉ ุงูุชุณุฌูู ุงูุฌุฏูุฏ    |
| `src/app/forgot-password/page.tsx` | โ     | ุตูุญุฉ ูุณูุงู ูููุฉ ุงููุฑูุฑ |
| `src/app/reset-password/page.tsx`  | โ     | ุตูุญุฉ ุฅุนุงุฏุฉ ุงูุชุนููู     |
| `src/app/dashboard/layout.tsx`     | โ     | ุญูุงูุฉ Dashboard        |
| `src/middleware.ts`                | โ     | ูุนุงูุฌุฉ ุงูุทูุจุงุช         |
| `src/lib/supabase.ts`              | โ     | ุฅุนุฏุงุฏ Supabase         |
| `src/lib/supabaseData.ts`          | โ     | ุฌููุน ุฏูุงู ุงูุจูุงูุงุช     |
| `supabase/schema.sql`              | โ     | ูููู ูุงุนุฏุฉ ุงูุจูุงูุงุช    |

---

## ๐ ุงูุฎูุงุตุฉ

**ูุธุงู ุชุณุฌูู ุงูุฏุฎูู ููุงุนุฏุฉ ุงูุจูุงูุงุช:**

โ **ุขูู** - ุฌููุน ุงูุงุชุตุงูุงุช ูุดูุฑุฉุ ุงูุจูุงูุงุช ูุญููุฉ ุจู RLS  
โ **ูุงูู** - ุฌููุน ุงูููุฒุงุช ูุทุจูุฉ ููุฎุชุจุฑุฉ  
โ **ููุซูู** - ูุนุงูุฌุฉ ุฌููุน ุงูุฃุฎุทุงุก ูุงูุญุงูุงุช ุงูุญุฏูุฉ  
โ **ุณูู ุงูุงุณุชุฎุฏุงู** - ุฑุณุงุฆู ูุงุถุญุฉ ุจุงูุนุฑุจูุฉ  
โ **ุฌุงูุฒ ููุฅูุชุงุฌ** - Ready to deploy!

---

_ุชู ุงููุญุต ูุงูุชุญุณูู: 15 ูุจุฑุงูุฑ 2026_
