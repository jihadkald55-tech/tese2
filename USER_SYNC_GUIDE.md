# ุญู ูุดููุฉ ุนุฏู ุธููุฑ ุงููุณุชุฎุฏููู

# User Display Fix Guide

## ุงููุดููุฉ

ุงููุณุชุฎุฏููู ููุฌูุฏูู ูู `auth.users` (ูุธุงู ุงููุตุงุฏูุฉ) ููู ุบูุฑ ููุฌูุฏูู ูู ุฌุฏูู `public.users` (ูุงุนุฏุฉ ุงูุจูุงูุงุช).

---

## ุงูุญู (3 ุฎุทูุงุช ุณุฑูุนุฉ)

### ุงูุฎุทูุฉ 1๏ธโฃ: ุงูุชุญ Supabase SQL Editor

1. ุงุฐูุจ ุฅูู [Supabase Dashboard](https://app.supabase.com)
2. ุงุฎุชุฑ ูุดุฑูุนู **Medad System**
3. ูู ุงููุงุฆูุฉ ุงูุฌุงูุจูุฉ ุงุถุบุท ุนูู **SQL Editor**
4. ุงุถุบุท ุนูู **New Query**

---

### ุงูุฎุทูุฉ 2๏ธโฃ: ูุณุฎ ููุตู ุงูููุฏ

ุงูุณุฎ ุงูููุฏ ุงูุชุงูู ูุงูุตูู ูู SQL Editor:

```sql
-- ูุฒุงููุฉ ุงููุณุชุฎุฏููู ูู auth.users ุฅูู public.users
CREATE OR REPLACE FUNCTION public.sync_existing_users()
RETURNS TABLE(synced_count INT) AS $$
DECLARE
    v_count INT;
BEGIN
    INSERT INTO public.users (id, email, name, user_type, created_at, updated_at)
    SELECT
        au.id,
        au.email,
        COALESCE(au.raw_user_meta_data->>'name', au.email),
        COALESCE(au.raw_user_meta_data->>'user_type', 'student'),
        au.created_at,
        au.updated_at
    FROM auth.users au
    WHERE NOT EXISTS (
        SELECT 1 FROM public.users pu WHERE pu.id = au.id
    );

    GET DIAGNOSTICS v_count = ROW_COUNT;
    RETURN QUERY SELECT v_count;
END;
$$ LANGUAGE plpgsql SECURITY DEFINER;

-- ุชูููุฐ ุงููุฒุงููุฉ
SELECT * FROM public.sync_existing_users();

-- ุนุฑุถ ุงููุชุงุฆุฌ
SELECT
    COUNT(*) as total_users,
    COUNT(*) FILTER (WHERE user_type = 'student') as students,
    COUNT(*) FILTER (WHERE user_type = 'professor') as professors,
    COUNT(*) FILTER (WHERE user_type = 'admin') as admins
FROM public.users;
```

---

### ุงูุฎุทูุฉ 3๏ธโฃ: ุชุดุบูู ุงูููุฏ

1. ุงุถุบุท ุนูู ุฒุฑ **Run** (ุฃู ุงุถุบุท `Ctrl + Enter`)
2. ุงูุชุธุฑ ุญุชู ููุชูู ุงูุชูููุฐ
3. ุณุชุธูุฑ ุฑุณุงูุฉ ูุฌุงุญ ูุน ุนุฏุฏ ุงููุณุชุฎุฏููู ุงููุฒุงูููู

---

## ุงููุชูุฌุฉ ุงููุชููุนุฉ

ุณุชุฑู ุฌุฏูู ุจุงูุฅุญุตุงุฆูุงุช:

| total_users | students | professors | admins |
| ----------- | -------- | ---------- | ------ |
| 5           | 3        | 1          | 1      |

_(ุงูุฃุฑูุงู ูุซุงู ููุท)_

---

## ุงูุชุญูู ูู ุงููุฌุงุญ

1. ุงุฑุฌุน ุฅูู ูุงุฌูุฉ ุฅุฏุงุฑุฉ ุงููุณุชุฎุฏููู:

   ```
   https://medad-system.vercel.app/dashboard/admin/users
   ```

2. ูุฌุจ ุฃู ุชุธูุฑ ุฌููุน ุงููุณุชุฎุฏููู ุงูุขู! โ

---

## ููุงุญุธุงุช ูููุฉ

### โจ ููุฒุฉ ุชููุงุฆูุฉ

ุจุนุฏ ุชูููุฐ ูุฐุง ุงูููุฏุ **ุฌููุน ุงููุณุชุฎุฏููู ุงูุฌุฏุฏ** ุณูุชู ูุณุฎูู ุชููุงุฆูุงู ุฅูู `public.users` ุนูุฏ ุงูุชุณุฌูู (ุจูุถู ุงูู trigger ุงูููุฌูุฏ).

### ๐ฏ ูุง ูุนูู ุงูููุฏ

- โ ูุณุฎ ุฌููุน ุงููุณุชุฎุฏููู ูู `auth.users` ุฅูู `public.users`
- โ ุงูุญูุงุธ ุนูู ุงูุจุฑูุฏ ุงูุฅููุชุฑููู ูุงูุงุณู
- โ ุชุนููู ุงูุฏูุฑ ุงูุตุญูุญ (student/professor/admin)
- โ ุนุฏู ุชูุฑุงุฑ ุงููุณุชุฎุฏููู ุงูููุฌูุฏูู

### ๐ ุงูุฃูุงู

- ุณูุงุณุงุช RLS ููุฌูุฏุฉ ูุญูุงูุฉ ุงูุจูุงูุงุช
- ุงููุฏูุฑูู ููุท ูููููู ุฑุคูุฉ ุฌููุน ุงููุณุชุฎุฏููู
- ุงููุณุชุฎุฏููู ุงูุนุงุฏููู ูุฑูู ุจูุงูุงุชูู ููุท

---

## ูู ุญุงูุฉ ูุฌูุฏ ูุดููุฉ

ุฅุฐุง ูู ุชุธูุฑ ุงููุณุชุฎุฏููู ุจุนุฏ:

1. ุชุฃูุฏ ูู ุฃูู ูุณุฌู ุฏุฎูู ูู **admin**
2. ุฌุฑุจ ุชุญุฏูุซ ุงูุตูุญุฉ (`F5` ุฃู `Ctrl + R`)
3. ุงูุชุญ Console ูู ุงููุชุตูุญ (`F12`) ูุงุจุญุซ ุนู ุฃุฎุทุงุก

---

## ููู ุฌุงูุฒ ููุชุดุบูู

ููููู ุฃูุถุงู ูุชุญ ููู [sync-users.sql](sync-users.sql) ููุณุฎ ูุญุชูุงู ุจุงููุงูู.

---

**ุชู ุงูุชุญุฏูุซ:** 16 ูุจุฑุงูุฑ 2026  
**ุงูุฅุตุฏุงุฑ:** 1.0
